# name: 'Validate PR title'
# on:
#   pull_request_target:
#     types:
#       - opened
#       - edited
#       - synchronize
# jobs:
#   main:
#     name: Validate PR title
#     runs-on: ubuntu-latest
#     permissions:
#       pull-requests: read
#     steps:
#       - uses: amannn/action-semantic-pull-request@v6
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#         with:
#           types: |
#             major
#             minor
#             fix
#             chore
#           requireScope: false
#           subjectPattern: ^(?![A-Z]).+$
#           subjectPatternError: |
#             The subject "{subject}" found in the pull request title "{title}"
#             didn't match the configured pattern. Please ensure that the subject
#             doesn't start with an uppercase character.
#           wip: true
#           validateSingleCommit: false

name: 'Lint PR'

on:
  pull_request_target:
    types:
      - opened
      - edited
      - reopened

jobs:
  main:
    name: Validate PR title
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    steps:
      - name: Checkout code  
        uses: actions/checkout@v2  
      - name: Set up Python  
        uses: actions/setup-python@v5  
        with: 
          python-version: '3.10'  
      - name: Run Python script  
        env: 
          GH_TOKEN: ${{ github.token }}
          TAGS: |
            major
            minor
            fix
            chore
        run: | 
          PR_TITLE=$(gh pr view ${{ github.event.pull_request.number }} --json title --jq '.title')
          python -u infra/check_pr_title.py "$PR_TITLE"
          echo $PR_TITLE
