# ะะตะฝะตัะฐัะพั ะธะฝััะฐััััะบัััั

Supreme Infrastructure Generator - ััะพ ะฒัะตะพะฑัะตะผะปััะธะน ะธะฝััััะผะตะฝั, ะบะพัะพััะน ะฐะฒัะพะผะฐัะธะทะธััะตั ัะพะทะดะฐะฝะธะต ะธ ะฟะพะดะดะตัะถะบั ะฒัะตั ัะฐะนะปะพะฒ ะบะพะฝัะธะณััะฐัะธะธ ะธะฝััะฐััััะบัััั ะดะปั ะผะพะฝะพะฟัะตะฟะพะทะธัะพัะธั supreme-infra.

## ะะฑะทะพั

ะะตะฝะตัะฐัะพั ัะฐัะฟะพะปะพะถะตะฝ ะฒ ะดะธัะตะบัะพัะธะธ `infra/generate/` ะธ ัะพััะพะธั ะธะท ะฝะตัะบะพะปัะบะธั ัะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัั ะณะตะฝะตัะฐัะพัะพะฒ, ะบะพัะพััะต ัะฐะฑะพัะฐัั ะฒะผะตััะต ะดะปั ะฟะพะดะดะตัะถะฐะฝะธั ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ะฒะพ ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะฐั ะธะฝััะฐััััะบัััั:

1. **ะะตะฝะตัะฐัะพั ะบะพะฝัะธะณััะฐัะธะธ ัะพััะตัะฐ** - ะะตะฝะตัะธััะตั ะบะพะฝัะธะณััะฐัะธะธ ัะพััะตัะฐ ัะตัะฒะธัะพะฒ
2. **ะะฑะฝะพะฒะปััะพั ะฟัะพะฒะตัะพะบ ะฑะตะทะพะฟะฐัะฝะพััะธ** - ะะฑะฝะพะฒะปัะตั GitHub Actions workflows ะดะปั ัะบะฐะฝะธัะพะฒะฐะฝะธั ะฑะตะทะพะฟะฐัะฝะพััะธ
3. **ะะฑะฝะพะฒะปััะพั CD workflow** - ะะฑะฝะพะฒะปัะตั workflows ะฝะตะฟัะตััะฒะฝะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั
4. **ะะตะฝะตัะฐัะพั ัะฐะนะปะพะฒ values** - ะะตะฝะตัะธััะตั values ัะฐะนะปั Helm ัะฐััะพะฒ ะดะปั ะฒัะตั ะพะบััะถะตะฝะธะน

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะะปะฐะฒะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ

ะะปะฐะฒะฝัะน ะณะตะฝะตัะฐัะพั (`infra/generate/index.ts`) ะพัะบะตัััะธััะตั ะฒัะต ััะฑ-ะณะตะฝะตัะฐัะพัั ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ะฟะพััะดะบะต:

```typescript
console.log("๐ Step 1/4: Generating router configurations...");
generateRouterConfigs();

console.log("๐ Step 2/4: Updating security checks...");
updateSecurityChecks();

console.log("๐ Step 3/4: Updating CD workflow...");
updateCdWorkflow();

console.log("๐ Step 4/4: Generating values files...");
generateValuesForAllServices();
```

### ะััะพัะฝะธะบ ะบะพะฝัะธะณััะฐัะธะธ

ะัะต ะณะตะฝะตัะฐัะพัั ะธัะฟะพะปัะทััั ะตะดะธะฝัะน ะธััะพัะฝะธะบ ะฟัะฐะฒะดั: `services.yaml` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```yaml
services:
  nest:
    - name: backend
      description: Backend service (NestJS)

  next:
    - name: frontend
      description: Frontend service (Next.js)
```

## ะกัะฑ-ะณะตะฝะตัะฐัะพัั

### 1. ะะตะฝะตัะฐัะพั ะบะพะฝัะธะณััะฐัะธะธ ัะพััะตัะฐ

**ะะฐัะฟะพะปะพะถะตะฝะธะต**: `infra/generate/generate-router/`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะตะฝะตัะธััะตั ะบะพะฝัะธะณััะฐัะธะธ ัะพััะตัะฐ ะดะปั ัะตัะฒะธัะพะฒ ะฝะฐ ะพัะฝะพะฒะต ะธั NestJS ะบะพะฝััะพะปะปะตัะพะฒ.

**ะงัะพ ะดะตะปะฐะตั**:

- ะกะบะฐะฝะธััะตั NestJS ัะตัะฒะธัั ะฝะฐ ัะฐะนะปั ะบะพะฝััะพะปะปะตัะพะฒ
- ะะทะฒะปะตะบะฐะตั ะธะฝัะพัะผะฐัะธั ะพ ัะพััะฐั ะธะท ะดะตะบะพัะฐัะพัะพะฒ
- ะะตะฝะตัะธััะตั ัะฐะนะปั ะบะพะฝัะธะณััะฐัะธะธ ัะพััะตัะฐ
- ะะฑะฝะพะฒะปัะตั ะพะฟัะตะดะตะปะตะฝะธั ัะพััะตัะฐ ัะตัะฒะธัะฐ

**ะะตะฝะตัะธััะตะผัะต ัะฐะนะปั**:

- `services/{service}/router.yaml`

### 2. ะะฑะฝะพะฒะปััะพั ะฟัะพะฒะตัะพะบ ะฑะตะทะพะฟะฐัะฝะพััะธ

**ะะฐัะฟะพะปะพะถะตะฝะธะต**: `infra/generate/update-security-checks/`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะฑะฝะพะฒะปัะตั GitHub Actions workflows ะฟัะพะฒะตัะพะบ ะฑะตะทะพะฟะฐัะฝะพััะธ ะดะปั ะฒะบะปััะตะฝะธั ะฒัะตั ัะตัะฒะธัะพะฒ.

**ะงัะพ ะดะตะปะฐะตั**:

- ะงะธัะฐะตั ัะฟะธัะพะบ ัะตัะฒะธัะพะฒ ะธะท `services.yaml`
- ะะฑะฝะพะฒะปัะตั `.github/workflows/security-checks.yml`
- ะะพะฑะฐะฒะปัะตั NestJS ัะตัะฒะธัั ะฒ ะผะฐััะธัั `security-scan-nest`
- ะะพะฑะฐะฒะปัะตั Next.js ัะตัะฒะธัั ะฒ ะผะฐััะธัั `security-scan-next`

### 3. ะะฑะฝะพะฒะปััะพั CD workflow

**ะะฐัะฟะพะปะพะถะตะฝะธะต**: `infra/generate/update-cd-workflow/`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะฑะฝะพะฒะปัะตั workflow ะฝะตะฟัะตััะฒะฝะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั ัะตะบััะธะผ ัะฟะธัะบะพะผ ัะตัะฒะธัะพะฒ.

**ะงัะพ ะดะตะปะฐะตั**:

- ะงะธัะฐะตั ัะฟะธัะพะบ ัะตัะฒะธัะพะฒ ะธะท `services.yaml`
- ะะฑะฝะพะฒะปัะตั `.github/workflows/cd.yml`
- ะะพะฑะฐะฒะปัะตั ะฒัะต ัะตัะฒะธัั ะฒ ัะตะปะตะบัะพั ัััะฝะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั
- ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ะฟะตัะฒัะน ัะตัะฒะธั ะฟะพ ัะผะพะปัะฐะฝะธั

### 4. ะะตะฝะตัะฐัะพั ัะฐะนะปะพะฒ values

**ะะฐัะฟะพะปะพะถะตะฝะธะต**: `infra/generate/generate-overrides/`

**ะะฐะทะฝะฐัะตะฝะธะต**: ะะตะฝะตัะธััะตั ะฟะพะปะฝัะต ัะฐะนะปั values Helm ัะฐััะพะฒ ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ ะธ ะพะบััะถะตะฝะธะน.

**ะงัะพ ะดะตะปะฐะตั**:

- ะงะธัะฐะตั ะบะพะฝัะธะณััะฐัะธะธ ัะตัะฒะธัะพะฒ ะธะท `services/{service}/service.yaml`
- ะัะธะผะตะฝัะตั ะทะฝะฐัะตะฝะธั ะฟะพ ัะผะพะปัะฐะฝะธั ะธะท `infra/helmcharts/{service-type}/values.yaml`
- ะัะธะผะตะฝัะตั ัะฟะตัะธัะธัะตัะบะธะต ะดะปั ะพะบััะถะตะฝะธั overrides ะธะท `infra/helmcharts/{service-type}/environment-overrides.yaml`
- ะัะธะผะตะฝัะตั ัะฟะตัะธัะธัะตัะบะธะต ะดะปั ัะตัะฒะธัะฐ overrides ะธะท `services/{service}/service.yaml`
- ะะตะฝะตัะธััะตั ัะธะฝะฐะปัะฝัะต ัะฐะนะปั values ะดะปั ะบะฐะถะดะพะณะพ ะพะบััะถะตะฝะธั

**ะะตะฝะตัะธััะตะผัะต ัะฐะนะปั**:

- `infra/overrides/development/{service}.yaml`
- `infra/overrides/production/{service}.yaml`

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะะฐะฟััะบ ะฒัะตั ะณะตะฝะตัะฐัะพัะพะฒ

```bash
# ะะท ะบะพัะฝั ะฟัะพะตะบัะฐ
pnpm run generate
```

ะญัะพ ะทะฐะฟััะบะฐะตั ะฒัะต ะณะตะฝะตัะฐัะพัั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ ะธ ะฟัะตะดะพััะฐะฒะปัะตั ะฟะพะดัะพะฑะฝัะน ะฒัะฒะพะด:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ Supreme Infrastructure Generator
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ Step 1/4: Generating router configurations...
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Router configurations updated successfully!

๐ Step 2/4: Updating security checks...
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Security checks updated successfully!
  Nest services: backend
  Next services: frontend

๐ Step 3/4: Updating CD workflow...
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CD workflow updated successfully!
  Services: backend, frontend
  Default service: backend

๐ Step 4/4: Generating values files...
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Starting values generation process
โ Found 2 service(s) to process:
โ   โข backend (nest) - Backend service (NestJS)
โ   โข frontend (next) - Frontend service (Next.js)

[... ะฟะพะดัะพะฑะฝัะต ะปะพะณะธ ะณะตะฝะตัะฐัะธะธ ...]

โ Generation summary:
โ   Total files generated: 6

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ All generation tasks completed successfully!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐะฟััะบ ะพัะดะตะปัะฝัั ะณะตะฝะตัะฐัะพัะพะฒ

ะั ัะฐะบะถะต ะผะพะถะตัะต ะทะฐะฟััะบะฐัั ะณะตะฝะตัะฐัะพัั ะฟะพ ะพัะดะตะปัะฝะพััะธ:

```bash
# ะขะพะปัะบะพ ะบะพะฝัะธะณััะฐัะธะธ ัะพััะตัะฐ
pnpm run generate:router

# ะขะพะปัะบะพ ะฟัะพะฒะตัะบะธ ะฑะตะทะพะฟะฐัะฝะพััะธ ะธ CD workflow
pnpm run infra:generate

# ะขะพะปัะบะพ ัะฐะนะปั values
pnpm run generate:overrides
```

## ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ัะตัะฒะธัะฐ

ะงัะพะฑั ะดะพะฑะฐะฒะธัั ะฝะพะฒัะน ัะตัะฒะธั ะฒ ะธะฝััะฐััััะบัััั:

1. **ะะพะฑะฐะฒะธัั ะฒ services.yaml**:

```yaml
services:
  nest:
    - name: backend
      description: Backend service (NestJS)
    - name: my-new-service
      description: My new NestJS service

  next:
    - name: frontend
      description: Frontend service (Next.js)
```

2. **ะกะพะทะดะฐัั ะบะพะฝัะธะณััะฐัะธั ัะตัะฒะธัะฐ**:
   ะกะพะทะดะฐัั `services/my-new-service/service.yaml` ั ะฝะฐัััะพะนะบะฐะผะธ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ:

```yaml
# Service-specific Helm overrides
image:
  tag: "latest"

resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"

autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 5
```

3. **ะกะพะทะดะฐัั ััััะบัััั ะดะธัะตะบัะพัะธะน ัะตัะฒะธัะฐ**:

```
services/my-new-service/
โโโ src/
โโโ package.json
โโโ Dockerfile
โโโ service.yaml    # ะะพะฝัะธะณััะฐัะธั ัะตัะฒะธัะฐ
โโโ router.yaml     # ะะตะฝะตัะธััะตััั ะณะตะฝะตัะฐัะพัะพะผ ัะพััะตัะฐ
```

4. **ะะฐะฟัััะธัั ะณะตะฝะตัะฐัะพั**:

```bash
pnpm run generate
```

ะะตะฝะตัะฐัะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ:

- ะะพะฑะฐะฒะธั ัะตัะฒะธั ะฒ workflows ะฟัะพะฒะตัะพะบ ะฑะตะทะพะฟะฐัะฝะพััะธ
- ะะพะฑะฐะฒะธั ัะตัะฒะธั ะฒ ะพะฟัะธะธ ัะฐะทะฒะตัััะฒะฐะฝะธั CD
- ะกะณะตะฝะตัะธััะตั ัะฐะนะปั values Helm ะดะปั ะฒัะตั ะพะบััะถะตะฝะธะน
- ะกะพะทะดะฐัั ะบะพะฝัะธะณััะฐัะธั ัะพััะตัะฐ

## ะคะฐะนะปั ะบะพะฝัะธะณััะฐัะธะธ

### services.yaml (ะะดะธะฝัะน ะธััะพัะฝะธะบ ะฟัะฐะฒะดั)

```yaml
services:
  nest: # NestJS ัะตัะฒะธัั
    - name: backend
      description: Backend service (NestJS)

  next: # Next.js ัะตัะฒะธัั
    - name: frontend
      description: Frontend service (Next.js)
```

### ะะพะฝัะธะณััะฐัะธั ัะตัะฒะธัะฐ (service.yaml)

ะะฐะถะดัะน ัะตัะฒะธั ะธะผะตะตั ัะฒะพะน ัะพะฑััะฒะตะฝะฝัะน ัะฐะนะป ะบะพะฝัะธะณััะฐัะธะธ, ะบะพัะพััะน ะพะฟัะตะดะตะปัะตั ัะฟะตัะธัะธัะตัะบะธะต ะดะปั ัะตัะฒะธัะฐ overrides:

```yaml
# services/backend/service.yaml
image:
  tag: "latest"

service:
  port: 4000
  targetPort: 4000

env:
  NODE_ENV: "production"
  PORT: "4000"

resources:
  requests:
    cpu: "250m"
    memory: "256Mi"
  limits:
    cpu: "1000m"
    memory: "1Gi"

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
```

## Directory Structure

```
infra/
โโโ generate/                    # Main generator directory
โ   โโโ index.ts                # Main entry point (super-generator)
โ   โโโ README.md               # This documentation
โ   โโโ generate-router/        # Router configuration generator
โ   โ   โโโ index.ts
โ   โ   โโโ extract-nest-routes.ts
โ   โ   โโโ extract-next-routes.ts
โ   โโโ update-security-checks/ # Security checks workflow updater
โ   โ   โโโ index.ts
โ   โโโ update-cd-workflow/     # CD workflow updater
โ   โ   โโโ index.ts
โ   โโโ generate-overrides/     # Values files generator
โ       โโโ generate-overrides.ts
โ       โโโ index.ts
โ       โโโ README.md
โ       โโโ types.ts
โโโ helmcharts/                 # Helm chart templates
โ   โโโ backend-service/
โ   โโโ frontend-service/
โโโ overrides/                  # Generated values files
โ   โโโ development/
โ   โ   โโโ backend.yaml
โ   โ   โโโ frontend.yaml
โ   โโโ production/
โ       โโโ backend.yaml
โ       โโโ frontend.yaml
โโโ shared/                     # Shared utilities
    โโโ load-services.ts        # Service loading utility
```

## ะัะตะธะผััะตััะฒะฐ

- **ะะดะธะฝัะน ะธััะพัะฝะธะบ ะฟัะฐะฒะดั**: ะัั ะบะพะฝัะธะณััะฐัะธั ะฟัะธัะพะดะธั ะธะท `services.yaml`
- **ะะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะฐั ะฟะพะดะดะตัะถะบะฐ**: ะะตั ัััะฝัั ะพะฑะฝะพะฒะปะตะฝะธะน workflows ะธะปะธ ะบะพะฝัะธะณะพะฒ
- **ะกะพะณะปะฐัะพะฒะฐะฝะฝะพััั**: ะะฐัะฐะฝัะธััะตั ัะธะฝััะพะฝะธะทะฐัะธั ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ ะธะฝััะฐััััะบัััั
- **ะัะตะดะพัะฒัะฐัะตะฝะธะต ะพัะธะฑะพะบ**: ะกะฝะธะถะฐะตั ะพัะธะฑะบะธ ัััะฝะพะน ะบะพะฝัะธะณััะฐัะธะธ
- **ะะฐะทัะฐะฑะพััะธะบ ะพะฟัั**: ะะดะฝะฐ ะบะพะผะฐะฝะดะฐ ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั ะฒัะตะณะพ

## ะะพะณะดะฐ ะทะฐะฟััะบะฐัั ะณะตะฝะตัะฐัะพั

ะะฐะฟััะบะฐะนัะต ะณะตะฝะตัะฐัะพั ะฟะพัะปะต:

- ะะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒะพะณะพ ัะตัะฒะธัะฐ
- ะะทะผะตะฝะตะฝะธั ะบะพะฝัะธะณััะฐัะธะธ ัะตัะฒะธัะฐ ะฒ `service.yaml`
- ะะพะดะธัะธะบะฐัะธะธ ะทะฝะฐัะตะฝะธะน ะฟะพ ัะผะพะปัะฐะฝะธั ะฒ Helm ัะฐััะฐั
- ะะฑะฝะพะฒะปะตะฝะธั environment overrides
- ะะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒัั ะพะบััะถะตะฝะธะน

## ะฃัััะฐะฝะตะฝะธะต ะฝะตะธัะฟัะฐะฒะฝะพััะตะน

### ะัะธะฑะบะฐ "No services found"

ะฃะฑะตะดะธัะตัั, ััะพ `services.yaml` ัััะตััะฒัะตั ะธ ัะพะดะตัะถะธั ัะพัั ะฑั ะพะดะธะฝ ัะตัะฒะธั:

```yaml
services:
  nest:
    - name: backend
      description: Backend service (NestJS)
```

### ะัะธะฑะบะธ ะพะฑะฝะพะฒะปะตะฝะธั workflows

ะัะพะฒะตัััะต, ััะพ ัะฐะนะปั workflows ัััะตััะฒััั ะธ ะธะผะตัั ะฟัะฐะฒะธะปัะฝัั ััััะบัััั:

- `.github/workflows/security-checks.yml`
- `.github/workflows/cd.yml`

### ะัะธะฑะบะธ ะณะตะฝะตัะฐัะธะธ values

ะฃะฑะตะดะธัะตัั, ััะพ ะบะฐะถะดัะน ัะตัะฒะธั ะธะผะตะตั ัะฐะนะป `service.yaml`:

- `services/{service_name}/service.yaml`

## ะะฝัะตะณัะฐัะธั ั CI/CD

ะะตะฝะตัะฐัะพั ัะฐะทัะฐะฑะพัะฐะฝ ะดะปั ะฑะตััะพะฒะฝะพะน ัะฐะฑะพัั ั CI/CD pipeline:

1. **Pre-deployment**: ะะตะฝะตัะฐัะพั ะทะฐะฟััะบะฐะตััั ะดะปั ะพะฑะตัะฟะตัะตะฝะธั ะฐะบััะฐะปัะฝะพััะธ ะฒัะตั ะบะพะฝัะธะณะพะฒ
2. **Security Checks**: ะะฑะฝะพะฒะปะตะฝะฝัะต workflows ะฒะบะปััะฐัั ะฒัะต ัะตัะฒะธัั
3. **Deployment**: CD workflow ะธะผะตะตั ัะตะบััะธะน ัะฟะธัะพะบ ัะตัะฒะธัะพะฒ
4. **Helm Deployment**: ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะต ัะฐะนะปั values ะธัะฟะพะปัะทััััั ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั

ะญัะพ ะณะฐัะฐะฝัะธััะตั, ััะพ ะปัะฑัะต ะธะทะผะตะฝะตะฝะธั ะธะฝััะฐััััะบัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพััะฐะถะฐัััั ะฒ pipeline ัะฐะทะฒะตัััะฒะฐะฝะธั.
